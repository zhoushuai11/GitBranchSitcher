# 🧭 GitBranchSwitcher (Ultimate Edition)

**GitBranchSwitcher** 是一个专为 **Unity 游戏开发** 打造的高性能 Git 分支管理工具。基于 **WinForms (.NET 8)** 开发，解决了多仓库（主工程+子模块/资源仓）协同开发时的痛点。

它不仅能并发切线，还集成了 **仓库瘦身 (Git GC)**、**卷王排行榜**、**智能缓存** 等硬核功能。

-----

## ✨ 核心功能 (New\!)

| 功能模块 | 图标 | 详细描述 |
| :--- | :---: | :--- |
| **智能递归扫描** | 📂 | 不再需要手动配置子目录。只需添加父目录，工具会自动递归扫描所有 Git 仓库（自动跳过 `Library`/`Temp` 等垃圾目录）。 |
| **极速启动** | ⚡ | 内置 **结构化缓存** 系统。二次启动实现 **0秒加载**，只有手动点击“刷新”时才会执行硬盘扫描。 |
| **一键瘦身** | 🔥 | **独家功能**。对选中的父目录执行深度 `git gc --aggressive`，清理悬空对象，大幅减少 `.git` 体积。 |
| **卷王排行榜** | 🏆 | 基于内网共享文件的**无后端排行榜**。统计切线次数、摸鱼时长、瘦身贡献，角逐“香肠切线王/摸鱼王/瘦身王”。 |
| **并发切线** | 🚀 | 支持 **16 线程** 并发操作，配合 **Fast Mode**（跳过 Fetch），切线速度提升 300%。 |
| **安全修复** | 🛠️ | 提供 **“解锁与修复”** 功能，一键删除意外残留的 `.lock` 文件并执行健康检查。 |
| **老板模式** | 💼 | 支持编译宏 `BOSS_MODE`。开启后隐藏排行榜、表情包和娱乐文案，变身严肃的企业级工具。 |

-----

## 🖥️ 使用指南

### 1\. 基础切线

1.  **添加目录**：点击左上角 **“添加父目录”**，选择项目根目录（如 `D:\MyUnityProject`）。
    * 工具会自动找出该目录下的 `Assets/Script`、`Assets/Art` 等所有 Git 仓。
2.  **选择分支**：在右侧下拉框选择目标分支（支持模糊搜索）。
3.  **极速模式**：勾选 **`⚡ 极速本地切换`**，将跳过 `git fetch` 和 `git pull`，仅执行本地切换，瞬间完成。
4.  **执行**：点击 **“🚀 一键切线”**。

### 2\. 仓库维护 (瘦身)

1.  点击工具栏红色的 **“🔥 一键瘦身”** 按钮。
2.  **双重确认**：因为深度 GC 会占满 CPU 且耗时较长，系统会弹出两次确认框。
3.  **选择范围**：在弹出的列表中勾选需要清理的父目录。
4.  **挂机等待**：工具会自动排队处理所有子仓库。完成后会弹窗显示总共为您节省了多少磁盘空间（MB/GB）。

### 3\. 排行榜 (社交)

* 点击 **“🏆 排行榜”** 按钮。
* **首次使用**：需要输入公司内网的共享文件路径（例如 `\\Server\Share\rank.json`）。
* **三大榜单**：
    * 🌭 **香肠切线王**：切线次数最多的人。
    * 🐟 **香肠摸鱼王**：切线总耗时最久的人（等待时间 = 摸鱼时间）。
    * 🥦 **香肠瘦身王**：通过 GC 清理磁盘空间最多的人。

-----

## ⚙️ 配置文件与缓存

配置文件位于 `%AppData%\GitBranchSwitcher\settings.json`。

```json
{
  "StashOnSwitch": true,
  "FastMode": false,
  "MaxParallel": 16,
  "LeaderboardPath": "\\\\SERVER\\Public\\git_rank.json",
  "RepositoryCache": [ 
    // 自动生成的缓存，请勿手动修改
    {
      "ParentPath": "D:\\Work\\ProjectA",
      "Children": [ ... ]
    }
  ],
  "CachedBranchList": [ ... ]
}
```

> **注意**：如果发现仓库列表不准，请点击工具栏上的 **“🔄 刷新/重扫”** 按钮，强制更新缓存。

-----

## 🏗️ 编译说明 (开发者)

### 开启/关闭“老板模式”

如果你想在公司内部发布一个**严肃版本**（去娱乐化）：

1.  打开 `GitBranchSwitcher.csproj`。
2.  在 `<PropertyGroup>` 中添加或移除宏定义：

<!-- end list -->

```xml
<DefineConstants>BOSS_MODE</DefineConstants>
```

### 资源嵌入

项目使用了 `EmbeddedResource` 技术：

* **图标**：`AppIcon.ico` 直接编译进 exe，无外部依赖。
* **图片**：Loading 图、状态图均内嵌，单文件绿色运行。

-----

## 🛠️ 常见问题

**Q: 排行榜无法显示？**
A: 请确保你输入的共享路径（如 `\\192.168.1.x\Share\rank.json`）对所有同事都有**读写权限**。

**Q: 切线时提示 index.lock 文件已存在？**
A: 右键点击报错的仓库，选择 **“🛠️ 解锁与修复”**，工具会强制删除锁文件。

**Q: 扫描不到我的仓库？**
A: 确保你的文件夹里有 `.git` 隐藏目录。如果是新拉取的目录，请点击 **“🔄 刷新”** 按钮。